/**
 * WTChessBoard - A small & fast javascript chess board
 * 
 * @author Anuj Kumar <webtricks.ak@gmail.com>
 * @link https://github.com/wtricks/wtchessboard
 * @link https://instagram.com/webtricks.ak
 */
const WTChessBoard=()=>{let k=["A","B","C","D","E","F","G","H"],l="ontouchstart"in window||navigator.msMaxTouchPoints?["touchstart","touchmove","touchend"]:["mousedown","mousemove","mouseup"],m={k:"king",q:"queen",n:"knight",p:"pawn",r:"rook",b:"bishop"},n=!0,o,p,q={},r={},s={},t={},u,v,w,x,y,z,A,B,C,D=[],E,F,G,H,I,J,K,L,M={},N,O,P=(a=!1)=>{for(type in s)s[type].forEach(b=>{R(q[b],type,a),"capture"==type&&R(r[b],type,a)})},Q=a=>{let b=Math.floor(a/8)+1;return k[a-(8*b-8)]+b},R=(a,b,c=!1)=>{a&&(c?a.classList.remove(b):a.classList.add(b))},S=(a,b=null,c=null,d=!1)=>{r[a]&&(b&&c||(r[a].square=a),b=b??M[a].x-E.x,c=c??M[a].y-E.y,d?(r[a].style.right=b+"px",r[a].style.bottom=c+"px",r[a].style.left=r[a].style.top="unset"):(r[a].style.left=b+"px",r[a].style.top=c+"px",r[a].style.right=r[a].style.bottom="unset"))},T=()=>{for(let a in B=q.A1.offsetHeight,E=p.getBoundingClientRect(),C=u?p.querySelector(".wt-square").offsetWidth:0,o.style.setProperty("--square",B+"px"),q)M[a]={x:q[a].getBoundingClientRect().x,y:q[a].getBoundingClientRect().y},r[a]&&S(a)},U=(a,b)=>{b?r[a].addEventListener(l[0],V):r[a].addEventListener("click",Y)},V=a=>{Y(a),w&&R(r[A],"animate",!0),R(r[A],"active"),document.addEventListener(l[1],W),document.addEventListener(l[2],X)},W=a=>{"touchstart"!==l[0]?(F=a.pageX,G=a.pageY):(F=a.touches[0].pageX,G=a.touches[0].pageY),S(A,F-(E.x+.5*B),G-(E.y+.5*B),"b"==v&&N),F=Math.floor((F-(E.x+C))/B),G=Math.floor((G-(E.y+C))/B),"b"==v&&(F=7-F,G=7-G),H=Q((7-G)*8+F),(H=H[1]<1?null:H)&&(I&&R(q[I],"hover",!0),t.some(a=>a==H)&&R(q[I=H],"hover"))},X=()=>{P(!0),w&&R(r[A],"animate"),R(r[A],"active",!0),document.removeEventListener(l[1],W),document.removeEventListener(l[2],X),H&&t.some(a=>a==H)?Z(H,!1):S(A),I&&R(q[I],"hover",!0),I=null,t={}},Y=b=>{let a=b.target.square,c=b.target.color;r[a]&&(A&&c!==v&&s.capture.some(b=>b==a)?(K(A,a),P(!0),A=null,s={}):(P(!0),s=_(J(a)),A=a,t=s.valid.concat(s.capture),P(!1)))},a=a=>(r[a]&&(r[a].remove(),delete r[a]),"At provided square, there is no piece"),b=(a,b)=>{r[a]&&(aa(),r[b]=r[a],S(b),delete r[a])},Z=(a,b=!0)=>{a.target&&(a=a.target.square),(!z||!b)&&A&&t.some(b=>b==a)&&(K(A,a),P(!0),A=null,s={})},c=()=>{if(w&&!n)for(let a in r)R(r[a],"animate",!0);R(o,"border",!!u),u=!u,n||T(),w&&!n&&setTimeout(()=>{for(let a in r)R(r[a],"animate")},O)},d=()=>{R(o,"pause",!!y),y=!y},e=(a="b")=>{let b="b"==(v=a.toLowerCase());N&&setTimeout(()=>{R(o,"black",!b)},O)},f=()=>{R(o,"marble",!!x),x=!x},g=()=>{for(let a in r)z?r[a].removeEventListener(l[0],V):r[a].removeEventListener("click",Y),U(a,!z);z=!z},$=(f,g,d,h,i,j)=>{if(!n)return;d.innerHTML='<div class="wt-chess"><div class="wt-chess-inner"></div></div>',p=d=d.querySelector(".wt-chess-inner"),o=document.querySelector(".wt-chess"),(w=h)&&p.classList.add("animate"),f&&c(),o.classList.add(g),o.style.setProperty("--pieceTransition",j+"s"),o.style.setProperty("--boardTransition",i+"s");let e=0;line=8,sqr="",n=!1;for(let a=0;a<100;a++){let b=document.createElement("div");R(b,"wt-square"),(a<10||a>89)&&R(b,"wt-border-height"),((a+1)%10==0||a%10==0)&&R(b,"wt-border-width"),(a%10==0||(a+1)%10==0)&&0!=a&&90!=a&&9!=a&&99!=a?b.textContent=Math.floor((a%10==0?9:10)-a/10):a>0&&a<9||a>90&&a<99?b.textContent=k[(a>10?a-90:a)-1].toLowerCase():a>10&&a<89&&(q[sqr=Q((8-e)*8-line)]=b,b.classList.add((a-e)%2==0?"black":"white"),b.addEventListener("click",Z),(a+2)%10==0&&e++,0== --line&&(line=8),b.square=sqr),d.append(b)}},h=(a,c,d)=>{if(c=c.toLowerCase(),!m.hasOwnProperty(c))return"Unknown piece name given";if(r.hasOwnProperty(a))return"Two piece can not be placed at same square";let b=document.createElement("div");R(b,"wt-piece"),b.style.backgroundImage=`url(${L}${d.toLowerCase()}_${m[c.toLowerCase()]}.png)`,w&&R(b,"animate"),r[a]=b,r[a].color=d,S(a),p.append(b),U(a,z)},_=a=>{let b={valid:[],capture:[]};return a&&Array.isArray(a.valid)&&(b.valid=a.valid),a&&Array.isArray(a.capture)&&(b.capture=a.capture),b},i=e=>{let{rotate:f,theme:d,border:g,el:a,dragable:h,moves:b,move:c,assets:i,animate:j,boardAnimationSpeed:k,pieceAnimationSpeed:l}=e??{theme:"wooden",border:!0,animate:!1,dragable:!1};return(a=document.querySelector(a))?"function"!=typeof b?`Invalid callback function given ${b}`:"function"!=typeof c?`Invalid callback function given ${c}`:void($(g,d=["wooden","marble"].some(a=>a==d)?d:"wooden",a,j,k??1.2,O=l??.5),T(),z=h,L=i,K=c,J=b,N=!!f,window.addEventListener("resize",T)):`Invalid selector '${a}' given`},j=(a,b=!1)=>{if(!q[a])return'Unknown position of board "'+a+'"';D.push(a),R(q[a],"check",b),R(q[a],"hover",b)},aa=()=>{0!=D.length&&(D.forEach(a=>j(a,!0)),D.length=0)};return{addPiece:h,removePiece:a,highlight:j,movePiece:b,toggleBorder:c,toggleDragClick:g,togglePuase:d,toggleTheme:f,load:i,toggleTurn:e}}